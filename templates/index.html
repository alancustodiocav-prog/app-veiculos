<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistema de Ve√≠culos</title>
  <style>
    /* Dark theme: preto e cinza */
    body { background:#111; color:#eee; font-family: Arial, sans-serif; margin:0; padding:0 16px 50px 16px;}
    header { padding:16px 0; display:flex; align-items:center; justify-content:space-between; }
    h1 { margin:0; font-size:20px; color:#fff; }
    .card { background:#1b1b1b; border-radius:6px; padding:12px; margin-bottom:12px; box-shadow:0 2px 4px rgba(0,0,0,0.6);}
    label { display:block; font-size:12px; color:#ccc; margin-bottom:4px; }
    input[type=text], input[type=date], textarea { background:#2b2b2b; border:1px solid #333; color:#fff; padding:8px; width:100%; border-radius:4px; }
    textarea { min-height:64px; resize:vertical; }
    .row { display:flex; gap:8px; flex-wrap:wrap; }
    .col { flex:1; min-width:160px; }
    .btn { background:#2f2f2f; color:#fff; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
    .btn.primary { background:#3a7bd5; }
    .btn.danger { background:#b23a3a; }
    .table { width:100%; border-collapse:collapse; margin-top:12px; }
    .table th, .table td { padding:8px; border-bottom:1px solid #222; font-size:13px; text-align:left; vertical-align:top;}
    .small { font-size:12px; color:#bbb; }
    .flex { display:flex; gap:8px; align-items:center; }
    .search { width:260px; }
    .msg { padding:8px; border-radius:6px; margin-bottom:8px; }
    .msg.success { background:#153b18; color:#b6f0b6; }
    .msg.error { background:#3b1515; color:#f0b6b6; }
    a.link { color:#9fc5ff; text-decoration:none; }
    footer { margin-top:20px; font-size:12px; color:#999; }
  </style>
</head>
<body>
  <header>
    <h1>üöó Sistema de Ve√≠culos</h1>
    <div class="flex">
      <form method="get" action="/" style="display:flex; gap:8px; align-items:center;">
        <input class="search" type="text" name="q" placeholder="Buscar por placa, nome, processo..." value="{{ query|default('') }}">
        <button class="btn" type="submit">Buscar</button>
        <a class="btn" href="{{ url_for('index') }}">Limpar</a>
      </form>
    </div>
  </header>

  <div class="card">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for cat, msg in messages %}
          <div class="msg {{ 'success' if cat=='success' else 'error' }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Se estivermos editando, abre o formul√°rio de edi√ß√£o; caso contr√°rio, formul√°rio de novo -->
    {% if edit_registro is defined %}
      <h3>Editar registro (√≠ndice {{ edit_index }})</h3>
      <form method="post" action="{{ url_for('editar', idx=edit_index) }}">
    {% else %}
      <h3>Adicionar novo ve√≠culo</h3>
      <form method="post" action="{{ url_for('adicionar') }}">
    {% endif %}

      <div class="row">
        {% for i, campo in enumerate(campos) %}
          <div class="col">
            <label>{{ campo }}</label>
            {% if campo == 'OBSERVA√á√ÉO' %}
              <textarea name="{{ campo }}">{{ edit_registro[campo] if edit_registro is defined else '' }}</textarea>
            {% elif campo == 'DATA DE NASCIMENTO' %}
              <input type="date" name="{{ campo }}" value="{{ edit_registro[campo] if edit_registro is defined else '' }}">
            {% else %}
              <input type="text" name="{{ campo }}" value="{{ edit_registro[campo] if edit_registro is defined else '' }}">
            {% endif %}
          </div>
          {% if (i+1) % 5 == 0 %}
            </div><div class="row" style="margin-top:8px;">
          {% endif %}
        {% endfor %}
      </div>

      <div style="margin-top:10px;">
        <button class="btn primary" type="submit">Salvar</button>
        {% if edit_registro is defined %}
          <a class="btn" href="{{ url_for('index') }}">Cancelar edi√ß√£o</a>
        {% endif %}
      </div>
    </form>
  </div>

  <div class="card">
    <h3>Registros ({{ registros|length }})</h3>
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          {% for c in campos %}
            <th>{{ c }}</th>
          {% endfor %}
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        {% for i, r in enumerate(registros) %}
          <tr>
            <td class="small">{{ i }}</td>
            {% for c in campos %}
              <td>{{ r[c] }}</td>
            {% endfor %}
            <td>
              <form method="post" action="{{ url_for('excluir', idx=i) }}" style="display:inline">
                <button class="btn danger" onclick="return confirm('Confirmar exclus√£o?')" type="submit">Excluir</button>
              </form>
              <a class="btn" href="{{ url_for('editar', idx=i) }}">Editar</a>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="{{ campos|length + 2 }}">Nenhum registro encontrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <footer>
    <div class="small">Salvo em arquivo <strong>banco.csv</strong>. Para atualizar no Render: salve, commit e push no GitHub.</div>
  </footer>
</body>
</html>
